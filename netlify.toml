[build]
  # Monorepo için root'ta build yap, her iki Next.js uygulamasını da build et
  # Path-based routing: /necrodev/* -> necrodev, /* -> necroplay
  base = "."
  command = "pnpm run build:netlify"
  # Necroplay root'ta, necrodev /necrodev path'inde
  publish = "apps/necroplay/.next"

[build.environment]
  NODE_VERSION = "18"
  PNPM_VERSION = "8.12.0"
  # Monorepo için workspace ayarları
  PNPM_FLAGS = "--filter @necroverse/necrodev... --filter @necroverse/necroplay..."

# Path-based routing için redirects
# /necrodev/* -> necrodev uygulamasına yönlendir
# Necrodev basePath ile /necrodev prefix'i eklenmiş, build output'una merge edilmiş
# Next.js plugin necroplay'i serve ediyor, ancak merge edilmiş build output'unda necrodev de var
[[redirects]]
  from = "/necrodev"
  to = "/necrodev/"
  status = 200

# Necrodev için tüm path'leri Next.js function'a yönlendir
# Merge edilmiş build output'unda necrodev'in server files'ları var
[[redirects]]
  from = "/necrodev/*"
  to = "/.netlify/functions/next"
  status = 200
  force = true

# Root ve diğer path'ler -> necroplay uygulamasına yönlendir (Next.js plugin otomatik yönetir)
# Next.js plugin sadece bir uygulama için çalışır, bu yüzden necroplay root'ta
[[plugins]]
  package = "@netlify/plugin-nextjs"
  # Next.js plugin otomatik olarak apps/necroplay dizinindeki Next.js'i algılar
